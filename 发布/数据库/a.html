    <h2>示例表和数据SQL</h2>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"sql\" data-theme=\"github-dark-dimmed\"><code data-language=\"sql\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">DROP</span><span style=\"color:#F47067\"> TABLE</span><span style=\"color:#F47067\"> IF</span><span style=\"color:#F47067\"> EXISTS</span><span style=\"color:#96D0FF\"> `actor`</span><span style=\"color:#ADBAC7\">;</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">CREATE</span><span style=\"color:#F47067\"> TABLE</span><span style=\"color:#ADBAC7\"> `</span><span style=\"color:#DCBDFB\">actor</span><span style=\"color:#ADBAC7\">`</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">(</span></span>\n<span data-line=\"\"><span style=\"color:#96D0FF\">    `id`</span><span style=\"color:#F47067\">          int</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#6CB6FF\">11</span><span style=\"color:#ADBAC7\">) </span><span style=\"color:#F47067\">NOT NULL</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#96D0FF\">    `name`</span><span style=\"color:#F47067\">        varchar</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#6CB6FF\">45</span><span style=\"color:#ADBAC7\">) </span><span style=\"color:#F47067\">DEFAULT</span><span style=\"color:#F47067\"> NULL</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#96D0FF\">    `update_time`</span><span style=\"color:#F47067\"> datetime</span><span style=\"color:#F47067\">    DEFAULT</span><span style=\"color:#F47067\"> NULL</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">    PRIMARY KEY</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#96D0FF\">`id`</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">) ENGINE </span><span style=\"color:#F47067\">=</span><span style=\"color:#ADBAC7\"> InnoDB</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  DEFAULT</span><span style=\"color:#ADBAC7\"> CHARSET </span><span style=\"color:#F47067\">=</span><span style=\"color:#ADBAC7\"> utf8;</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">INSERT INTO</span><span style=\"color:#96D0FF\"> `actor`</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#96D0FF\">`id`</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#96D0FF\">`name`</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#96D0FF\">`update_time`</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">VALUES</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#96D0FF\">'a'</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#96D0FF\">'2017-12-29 10:27:18'</span><span style=\"color:#ADBAC7\">),</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">       (</span><span style=\"color:#6CB6FF\">2</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#96D0FF\">'b'</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#96D0FF\">'2017-12-29 15:27:18'</span><span style=\"color:#ADBAC7\">),</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">       (</span><span style=\"color:#6CB6FF\">3</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#96D0FF\">'c'</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#96D0FF\">'2017-12-29 15:27:18'</span><span style=\"color:#ADBAC7\">);</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">DROP</span><span style=\"color:#F47067\"> TABLE</span><span style=\"color:#F47067\"> IF</span><span style=\"color:#F47067\"> EXISTS</span><span style=\"color:#96D0FF\"> `film`</span><span style=\"color:#ADBAC7\">;</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">CREATE</span><span style=\"color:#F47067\"> TABLE</span><span style=\"color:#ADBAC7\"> `</span><span style=\"color:#DCBDFB\">film</span><span style=\"color:#ADBAC7\">`</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">(</span></span>\n<span data-line=\"\"><span style=\"color:#96D0FF\">    `id`</span><span style=\"color:#F47067\">   int</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#6CB6FF\">11</span><span style=\"color:#ADBAC7\">) </span><span style=\"color:#F47067\">NOT NULL</span><span style=\"color:#ADBAC7\"> AUTO_INCREMENT,</span></span>\n<span data-line=\"\"><span style=\"color:#96D0FF\">    `name`</span><span style=\"color:#F47067\"> varchar</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#6CB6FF\">10</span><span style=\"color:#ADBAC7\">) </span><span style=\"color:#F47067\">DEFAULT</span><span style=\"color:#F47067\"> NULL</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">    PRIMARY KEY</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#96D0FF\">`id`</span><span style=\"color:#ADBAC7\">),</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">    KEY</span><span style=\"color:#96D0FF\"> `idx_name`</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#96D0FF\">`name`</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">) ENGINE </span><span style=\"color:#F47067\">=</span><span style=\"color:#ADBAC7\"> InnoDB</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  DEFAULT</span><span style=\"color:#ADBAC7\"> CHARSET </span><span style=\"color:#F47067\">=</span><span style=\"color:#ADBAC7\"> utf8;</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">INSERT INTO</span><span style=\"color:#96D0FF\"> `film`</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#96D0FF\">`id`</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#96D0FF\">`name`</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">VALUES</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#6CB6FF\">3</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#96D0FF\">'film0'</span><span style=\"color:#ADBAC7\">),</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">       (</span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#96D0FF\">'film1'</span><span style=\"color:#ADBAC7\">),</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">       (</span><span style=\"color:#6CB6FF\">2</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#96D0FF\">'film2'</span><span style=\"color:#ADBAC7\">);</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">DROP</span><span style=\"color:#F47067\"> TABLE</span><span style=\"color:#F47067\"> IF</span><span style=\"color:#F47067\"> EXISTS</span><span style=\"color:#96D0FF\"> `film_actor`</span><span style=\"color:#ADBAC7\">;</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">CREATE</span><span style=\"color:#F47067\"> TABLE</span><span style=\"color:#ADBAC7\"> `</span><span style=\"color:#DCBDFB\">film_actor</span><span style=\"color:#ADBAC7\">`</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">(</span></span>\n<span data-line=\"\"><span style=\"color:#96D0FF\">    `id`</span><span style=\"color:#F47067\">       int</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#6CB6FF\">11</span><span style=\"color:#ADBAC7\">) </span><span style=\"color:#F47067\">NOT NULL</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#96D0FF\">    `film_id`</span><span style=\"color:#F47067\">  int</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#6CB6FF\">11</span><span style=\"color:#ADBAC7\">) </span><span style=\"color:#F47067\">NOT NULL</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#96D0FF\">    `actor_id`</span><span style=\"color:#F47067\"> int</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#6CB6FF\">11</span><span style=\"color:#ADBAC7\">) </span><span style=\"color:#F47067\">NOT NULL</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#96D0FF\">    `remark`</span><span style=\"color:#F47067\">   varchar</span><span style=\"color:#ADBAC7\">(</span><span style=\"color:#6CB6FF\">255</span><span style=\"color:#ADBAC7\">) </span><span style=\"color:#F47067\">DEFAULT</span><span style=\"color:#F47067\"> NULL</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">    PRIMARY KEY</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#96D0FF\">`id`</span><span style=\"color:#ADBAC7\">),</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">    KEY</span><span style=\"color:#96D0FF\"> `idx_film_actor_id`</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#96D0FF\">`film_id`</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#96D0FF\">`actor_id`</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">) ENGINE </span><span style=\"color:#F47067\">=</span><span style=\"color:#ADBAC7\"> InnoDB</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">  DEFAULT</span><span style=\"color:#ADBAC7\"> CHARSET </span><span style=\"color:#F47067\">=</span><span style=\"color:#ADBAC7\"> utf8;</span></span>\n<span data-line=\"\"> </span>\n<span data-line=\"\"><span style=\"color:#F47067\">INSERT INTO</span><span style=\"color:#96D0FF\"> `film_actor`</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#96D0FF\">`id`</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#96D0FF\">`film_id`</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#96D0FF\">`actor_id`</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">VALUES</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">),</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">       (</span><span style=\"color:#6CB6FF\">2</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#6CB6FF\">2</span><span style=\"color:#ADBAC7\">),</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">       (</span><span style=\"color:#6CB6FF\">3</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#6CB6FF\">2</span><span style=\"color:#ADBAC7\">, </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">);</span></span></code></pre></figure>\n<h2>id列</h2>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"sql\" data-theme=\"github-dark-dimmed\"><code data-language=\"sql\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">explain </span><span style=\"color:#F47067\">select</span><span style=\"color:#F47067\"> *</span><span style=\"color:#F47067\"> from</span><span style=\"color:#ADBAC7\"> film </span><span style=\"color:#F47067\">where</span><span style=\"color:#ADBAC7\"> id </span><span style=\"color:#F47067\">=</span><span style=\"color:#6CB6FF\"> 1</span><span style=\"color:#ADBAC7\">;</span></span></code></pre></figure>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"json\" data-theme=\"github-dark-dimmed\"><code data-language=\"json\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">[</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"SIMPLE\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"film\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"const\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"PRIMARY\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"PRIMARY\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"4\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"const\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">100</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">]</span></span></code></pre></figure>\n<p>其中，<code>id</code> 的编号就是 <code>select</code> 的序列号，有几个 <code>select</code> 就有几个 <code>id</code>，并且 id 的顺序是按 <code>select</code> 出现的顺序增长的，<em><code>id</code> 越大执行优先级越高，<code>id</code> 相同从上往下执行，<code>id</code> 为 <code>NULL</code> 最后执行</em>。</p>\n<h2>select_type列</h2>\n<p><code>select_type</code> 表示对应行是简单还是复杂的查询。</p>\n<h3>simple</h3>\n<p>简单查询，查询不包含子查询和 <code>union</code></p>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"sql\" data-theme=\"github-dark-dimmed\"><code data-language=\"sql\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">EXPLAIN</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">SELECT</span><span style=\"color:#F47067\"> *</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">FROM</span><span style=\"color:#ADBAC7\"> film</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">WHERE</span><span style=\"color:#ADBAC7\"> id </span><span style=\"color:#F47067\">=</span><span style=\"color:#6CB6FF\"> 1</span><span style=\"color:#ADBAC7\">;</span></span></code></pre></figure>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"json\" data-theme=\"github-dark-dimmed\"><code data-language=\"json\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">[</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"SIMPLE\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"film\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"const\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"PRIMARY\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"PRIMARY\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"4\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"const\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">100</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">]</span></span></code></pre></figure>\n<h3>primary, subquery, derived</h3>\n<ul>\n<li><code>primary</code>，复杂查询中最外层的 <code>select</code></li>\n<li><code>subquery</code>，包含在 <code>select</code> 中的子查询(不在 <code>from</code> 子句中)</li>\n<li><code>derived</code>，包含在 <code>from</code> 子句中的子查询。Mysql 会将结果存放在一个临时表中，也称为派生表。</li>\n</ul>\n<p>用下面这个例子来了解 <code>primary</code>、<code>subquery</code> 和 <code>derived</code> 类型</p>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"sql\" data-theme=\"github-dark-dimmed\"><code data-language=\"sql\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\"># </span><span style=\"color:#6CB6FF\">关闭mysql5</span><span style=\"color:#ADBAC7\">.</span><span style=\"color:#6CB6FF\">7新特性对衍生表的合并优化</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">SET</span><span style=\"color:#F47067\"> SESSION</span><span style=\"color:#ADBAC7\"> optimizer_switch </span><span style=\"color:#F47067\">=</span><span style=\"color:#96D0FF\"> 'derived_merge=off'</span><span style=\"color:#ADBAC7\">;</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">EXPLAIN</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">SELECT</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#F47067\">SELECT</span><span style=\"color:#6CB6FF\"> 1</span><span style=\"color:#F47067\"> FROM</span><span style=\"color:#ADBAC7\"> actor </span><span style=\"color:#F47067\">WHERE</span><span style=\"color:#ADBAC7\"> id </span><span style=\"color:#F47067\">=</span><span style=\"color:#6CB6FF\"> 1</span><span style=\"color:#ADBAC7\">)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">FROM</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#F47067\">SELECT</span><span style=\"color:#F47067\"> *</span><span style=\"color:#F47067\"> FROM</span><span style=\"color:#ADBAC7\"> film </span><span style=\"color:#F47067\">WHERE</span><span style=\"color:#ADBAC7\"> id </span><span style=\"color:#F47067\">=</span><span style=\"color:#6CB6FF\"> 1</span><span style=\"color:#ADBAC7\">) der;</span></span></code></pre></figure>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"json\" data-theme=\"github-dark-dimmed\"><code data-language=\"json\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">[</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"PRIMARY\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"&#x3C;derived3>\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"system\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">100</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  },</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">3</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"DERIVED\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"film\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"const\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"PRIMARY\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"PRIMARY\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"4\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"const\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">100</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  },</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">2</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"SUBQUERY\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"actor\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"const\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"PRIMARY\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"PRIMARY\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"4\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"const\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">100</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"Using index\"</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"> </span></code></pre></figure>\n<p>其中，可以看到 id 最大值为3，表示有3个 <code>select</code> 语句，<code>id=3</code> 的查询对应的子查询是 <code>(select * from film where id = 1)</code> 部分，<code>id=2</code> 对应的是 <code>(select 1 from actor where id = 1)</code> 语句，<code>id=1</code> 则是最外层的<code>select</code>。</p>\n<h3>union</h3>\n<p>在 <code>union</code> 中的第二个和随后的 <code>select</code>。</p>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"sql\" data-theme=\"github-dark-dimmed\"><code data-language=\"sql\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">EXPLAIN</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">SELECT</span><span style=\"color:#6CB6FF\"> 1</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">UNION ALL</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">SELECT</span><span style=\"color:#6CB6FF\"> 1</span><span style=\"color:#ADBAC7\">;</span></span></code></pre></figure>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"json\" data-theme=\"github-dark-dimmed\"><code data-language=\"json\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">[</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"PRIMARY\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"No tables used\"</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  },</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">2</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"UNION\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"No tables used\"</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">]</span></span></code></pre></figure>\n<h2>table列</h2>\n<p>这一列表示 <code>explain</code> 的一行正在访问哪个表。它可以是下面值中的一个</p>\n<ul>\n<li><code>&#x3C;union M,N></code> 这一行引用了ID值为M和N的表的联合。M 和 N 表示 <code>union</code> 的 <code>select</code> 行的 <code>id</code>。</li>\n<li><code>&#x3C;deriven N></code> 这一行引用了ID值为N的表所派生的表。派生的表可能是一个结果集，比如，FROM 子句中的子查询，表示当前查询依赖 <code>id=N</code> 的查询，于是先执行 <code>id=N</code> 的查询。</li>\n<li><code>subquery N</code> 这一行引用了ID值为N的物化字查询的结果。参考：<a href=\"https://dev.mysql.com/doc/refman/5.7/en/subquery-materialization.html\">https://dev.mysql.com/doc/refman/5.7/en/subquery-materialization.html</a></li>\n</ul>\n<h2>type列</h2>\n<p>表示关联类型或者访问类型，即 Mysql 决定如何查找表中的行，查找数据行记录的大概范围。\n依次从最优到最差分别为：<code>system</code> > <code>const</code> > <code>eq_ref</code> > <code>ref</code> > <code>range</code> > <code>index</code> > <code>ALL</code>，一般来说，要<strong>保证查询达到 range 级别，最好达到 ref</strong>。</p>\n<h3>NULL值</h3>\n<p>mysql 能够在优化阶段分解查询语句，在执行阶段不需要访问表或者索引。例如：在索引列中选取最小值，可以单独查找索引来完成，不需要在执行时访问表。</p>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"sql\" data-theme=\"github-dark-dimmed\"><code data-language=\"sql\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">EXPLAIN</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">SELECT</span><span style=\"color:#6CB6FF\"> MIN</span><span style=\"color:#ADBAC7\">(id)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">FROM</span><span style=\"color:#ADBAC7\"> film;</span></span></code></pre></figure>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"json\" data-theme=\"github-dark-dimmed\"><code data-language=\"json\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">[</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"SIMPLE\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"Select tables optimized away\"</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">]</span></span></code></pre></figure>\n<h3>const, system</h3>\n<p>mysql 能对查询对某部分进行优化并将其转为一个常量(可以看 show warnings 的结果)。用于 <code>primary key</code> 或 <code>unique key</code> 的所有列与常数比较时，所以表最多有一个匹配行，读取1次，速度比较快。<code>system</code> 是 <code>const</code> 的特例，<strong>表里只有一条元组匹配时为</strong> <code>system**</code>。</p>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"sql\" data-theme=\"github-dark-dimmed\"><code data-language=\"sql\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#F47067\">SET</span><span style=\"color:#F47067\"> SESSION</span><span style=\"color:#ADBAC7\"> optimizer_switch </span><span style=\"color:#F47067\">=</span><span style=\"color:#96D0FF\"> 'derived_merge=off'</span><span style=\"color:#ADBAC7\">;</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">EXPLAIN EXTENDED</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">SELECT</span><span style=\"color:#F47067\"> *</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">FROM</span><span style=\"color:#ADBAC7\"> (</span><span style=\"color:#F47067\">SELECT</span><span style=\"color:#F47067\"> *</span><span style=\"color:#F47067\"> FROM</span><span style=\"color:#ADBAC7\"> film </span><span style=\"color:#F47067\">WHERE</span><span style=\"color:#ADBAC7\"> id </span><span style=\"color:#F47067\">=</span><span style=\"color:#6CB6FF\"> 1</span><span style=\"color:#ADBAC7\">) tmp;</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">SET</span><span style=\"color:#F47067\"> SESSION</span><span style=\"color:#ADBAC7\"> optimizer_switch </span><span style=\"color:#F47067\">=</span><span style=\"color:#96D0FF\"> 'derived_merge=on'</span><span style=\"color:#ADBAC7\">;</span></span></code></pre></figure>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"json\" data-theme=\"github-dark-dimmed\"><code data-language=\"json\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">[</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"PRIMARY\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"&#x3C;derived2>\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"system\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">100</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  },</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">2</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"DERIVED\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"film\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"const\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"PRIMARY\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"PRIMARY\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"4\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"const\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">100</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">]</span></span></code></pre></figure>\n<p>可以看到，<code>id=2</code> 的语句对应 (<code>select * from film where id = 1</code>) 查询，此时比较主键是否相等，类型为 <code>const</code>。<code>id=1</code> 的查询 临时表中只有一条数据，<code>const</code> 转为 <code>system</code>。</p>\n<h3>eq_ref</h3>\n<p>主键或者唯一索引的所有部分被连接使用，最多只会返回一条符合条件的记录。这可能是在 <code>const</code> 之外最好的联接类型了，简单的 <code>select</code> 查询不会出现这种 <code>type</code>。</p>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"sql\" data-theme=\"github-dark-dimmed\"><code data-language=\"sql\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">EXPLAIN</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">SELECT</span><span style=\"color:#F47067\"> *</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">FROM</span><span style=\"color:#ADBAC7\"> film_actor</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">         LEFT JOIN</span><span style=\"color:#ADBAC7\"> film </span><span style=\"color:#F47067\">ON</span><span style=\"color:#6CB6FF\"> film_actor</span><span style=\"color:#ADBAC7\">.</span><span style=\"color:#6CB6FF\">film_id</span><span style=\"color:#F47067\"> =</span><span style=\"color:#6CB6FF\"> film</span><span style=\"color:#ADBAC7\">.</span><span style=\"color:#6CB6FF\">id</span><span style=\"color:#ADBAC7\">;</span></span></code></pre></figure>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"json\" data-theme=\"github-dark-dimmed\"><code data-language=\"json\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">[</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"SIMPLE\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"film_actor\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"ALL\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">3</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">100</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  },</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"SIMPLE\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"film\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"eq_ref\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"PRIMARY\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"PRIMARY\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"4\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"vitah.film_actor.film_id\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">100</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">]</span></span></code></pre></figure>\n<h3>ref</h3>\n<p>相比 <code>eq_ref</code>，不使用唯一索引，而是使用普通索引或者唯一性索引的部分前缀，索引要和某个值相比较，可能会找到多个符合条件的行。</p>\n<ol>\n<li>简单的 <code>select</code> 查询，<code>name</code> 是普通索引（非唯一索引）</li>\n</ol>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"sql\" data-theme=\"github-dark-dimmed\"><code data-language=\"sql\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">EXPLAIN</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">SELECT</span><span style=\"color:#F47067\"> *</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">FROM</span><span style=\"color:#ADBAC7\"> film</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">WHERE</span><span style=\"color:#F47067\"> name</span><span style=\"color:#F47067\"> =</span><span style=\"color:#96D0FF\"> 'film1'</span><span style=\"color:#ADBAC7\">;</span></span></code></pre></figure>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"json\" data-theme=\"github-dark-dimmed\"><code data-language=\"json\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">[</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"SIMPLE\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"film\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"ref\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"idx_name\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"idx_name\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"33\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"const\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">100</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"Using index\"</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">]</span></span></code></pre></figure>\n<ol start=\"2\">\n<li>关联表查询，例如下面语句，<code>idx_film_actor_id</code> 是表 <code>film_actor</code> 字段 <code>film_id</code> 和 <code>actor_id</code> 的联合索引，这里使用到 <code>film_actor</code> 的左边前缀 <code>film_id</code> 部分。</li>\n</ol>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"sql\" data-theme=\"github-dark-dimmed\"><code data-language=\"sql\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">EXPLAIN</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">SELECT</span><span style=\"color:#ADBAC7\"> film_id</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">FROM</span><span style=\"color:#ADBAC7\"> film</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">         LEFT JOIN</span><span style=\"color:#ADBAC7\"> film_actor </span><span style=\"color:#F47067\">ON</span><span style=\"color:#6CB6FF\"> film</span><span style=\"color:#ADBAC7\">.</span><span style=\"color:#6CB6FF\">id</span><span style=\"color:#F47067\"> =</span><span style=\"color:#6CB6FF\"> film_actor</span><span style=\"color:#ADBAC7\">.</span><span style=\"color:#6CB6FF\">film_id</span><span style=\"color:#ADBAC7\">;</span></span></code></pre></figure>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"json\" data-theme=\"github-dark-dimmed\"><code data-language=\"json\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">[</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"SIMPLE\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"film\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"index\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"idx_name\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"33\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">3</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">100</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"Using index\"</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  },</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"SIMPLE\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"film_actor\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"ref\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"idx_film_actor_id\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"idx_film_actor_id\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"4\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"vitah.film.id\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">100</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"Using index\"</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">]</span></span></code></pre></figure>\n<h3>range</h3>\n<p>范围扫描通常出现在 <code>in()</code>, <code>between</code>, <code>></code>, <code>&#x3C;</code>, <code>≥</code> 等操作中，使用一个索引来检索给定范围的行</p>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"sql\" data-theme=\"github-dark-dimmed\"><code data-language=\"sql\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">EXPLAIN</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">SELECT</span><span style=\"color:#F47067\"> *</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">FROM</span><span style=\"color:#ADBAC7\"> actor</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">WHERE</span><span style=\"color:#ADBAC7\"> id </span><span style=\"color:#F47067\">></span><span style=\"color:#6CB6FF\"> 1</span><span style=\"color:#ADBAC7\">;</span></span></code></pre></figure>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"json\" data-theme=\"github-dark-dimmed\"><code data-language=\"json\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">[</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"SIMPLE\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"actor\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"range\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"PRIMARY\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"PRIMARY\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"4\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">2</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">100</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"Using where\"</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">]</span></span></code></pre></figure>\n<h3>index</h3>\n<p>扫描全索引就能拿到结果，一般是扫描某个二级索引，这种扫描不会从索引树根结点开始查找，而是直接对二级索引的叶子节点遍历和扫描，速度还是比较慢的，这种查询一般为覆盖索引，二级索引一般比较小，所以这种比 ALL 快一些。</p>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"sql\" data-theme=\"github-dark-dimmed\"><code data-language=\"sql\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">EXPLAIN</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">SELECT</span><span style=\"color:#F47067\"> *</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">FROM</span><span style=\"color:#ADBAC7\"> film;</span></span></code></pre></figure>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"json\" data-theme=\"github-dark-dimmed\"><code data-language=\"json\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">[</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"SIMPLE\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"film\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"index\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"idx_name\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"33\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">3</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">100</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"Using index\"</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">]</span></span></code></pre></figure>\n<h3>ALL</h3>\n<p>即全表扫描，扫描你的聚簇索引的所有叶子节点。通常这种情况就需要增加索引来优化了。</p>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"sql\" data-theme=\"github-dark-dimmed\"><code data-language=\"sql\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">EXPLAIN</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">SELECT</span><span style=\"color:#F47067\"> *</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">FROM</span><span style=\"color:#ADBAC7\"> actor;</span></span></code></pre></figure>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"json\" data-theme=\"github-dark-dimmed\"><code data-language=\"json\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">[</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"SIMPLE\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"actor\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"ALL\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">3</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">100</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">]</span></span></code></pre></figure>\n<h2>possible_keys列</h2>\n<p>这一列显示查询可能使用哪些索引来查找。\n<code>explain</code> 时可能 <strong>出现</strong> <code>possible_keys</code> 有列，而 <code>key</code> 显示 <code>NULL</code> 的情况，是因为表中数据不多，<code>mysql</code> 认为索引对此查询帮助不大，选择了全表查询。\n如果该列是 <code>NULL</code>，则没有相关的索引。在这种情况下，可以通过检查 <code>where</code> 子句看是否可以创造一个适当的索引来提高查询性能，然后用 <code>explain</code> 查询效果。</p>\n<h2>key列</h2>\n<p>显示 <code>mysql</code> 实际采用哪个索引来优化对该表的访问。\n如果没有使用索引，该列值是 <code>NULL</code>。如果想强制 <code>mysql</code> 使用或者忽视 <code>possible_keys</code> 列中的索引，可以使用 <code>force index</code>、<code>ignore index</code>。</p>\n<h2>列key_len</h2>\n<p>显示了在索引里使用的字节数，通过这个值可以算出具体使用了索引中的哪些列。</p>\n<p>比如表 <code>film_actor</code> 的联合索引 <code>idx_film_actor_id</code> 由 <code>film_id</code> 和 <code>actor_id</code> 两个 <code>int</code> 列组成，并且每个 <code>int</code> 是4字节。通过结果中的 <code>ken_len=4</code> 可推断出查询使用列第一个列：<code>film_id</code> 列来执行索引查找。</p>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"sql\" data-theme=\"github-dark-dimmed\"><code data-language=\"sql\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">EXPLAIN</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">SELECT</span><span style=\"color:#F47067\"> *</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">FROM</span><span style=\"color:#ADBAC7\"> film_actor</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">WHERE</span><span style=\"color:#ADBAC7\"> film_id </span><span style=\"color:#F47067\">=</span><span style=\"color:#6CB6FF\"> 2</span><span style=\"color:#ADBAC7\">;</span></span></code></pre></figure>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"json\" data-theme=\"github-dark-dimmed\"><code data-language=\"json\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">[</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"SIMPLE\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"film_actor\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"ref\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"idx_film_actor_id\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"idx_film_actor_id\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"4\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"const\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">100</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">]</span></span></code></pre></figure>\n<p><code>key_len</code> 的计算规则</p>\n<ul>\n<li>字符串，<code>char(n)</code> 和 <code>varchar(n)</code>，<code>n</code> 代表字符数，不是字节数，如果是 <code>utf-8</code>，一个数字或者字母占1字节，如果是汉字占3字节。<code>char(n)</code> 存汉字长度为 <code>3n</code> 字节，<code>varchar(n)</code> 存汉字长度为 <code>3n+2</code> 字节，需要额外2字节用来存储字符串长度。</li>\n<li>数值类型\n<ul>\n<li>tinyint 1字节</li>\n<li>smallint 2字节</li>\n<li>int 4字节</li>\n<li>bigint 8字节</li>\n</ul>\n</li>\n<li>时间类型\n<ul>\n<li>date 3字节</li>\n<li>timestamp 4字节</li>\n<li>datetime 8字节</li>\n</ul>\n</li>\n<li>字段允许为 <code>NULL</code>，需要额外1字节记录是否为 <code>NULL</code></li>\n</ul>\n<p><strong>索引的最大长度是768字节，当字符串过长时，mysql 会做一个类似左前缀索引的处理，将前半部分的字符提取出来做索引。</strong></p>\n<h2>ref列</h2>\n<p>显示了在 <code>key</code> 列记录的索引中，表查找值所用到的列或常量，常见的有 <code>const</code>(常量)，字段名(例如 film.id)</p>\n<h2>rows列</h2>\n<p><code>mysql</code> 估计要读取并检测的行数，并不是结果集里面的行数，<strong>只是一个估计值</strong>。</p>\n<h2>filtered列</h2>\n<p>表示返回结果的行数占需读取行数(列<code>rows</code>值)的百分比，<code>filtered</code> 列的值越大越好，<code>filtered</code> 列的值依赖于统计信息</p>\n<h2>Extra列</h2>\n<p>展示的是额外信息。常见的重要值如下：</p>\n<h3>1. Using index：使用覆盖索引</h3>\n<p>覆盖索引的定义：mysql 执行计划 <code>explain</code> 结果里的 <code>key</code> 列有使用索引，如果 <code>select</code> 后面查询的字段都可以从这个索引的树中获取，这种情况一般可以说是用到了覆盖索引，<code>extra</code> 里一般都有 <code>using index</code>。覆盖索引一般针对的是辅助索引，整个查询结果只通过辅助索引就能拿到结果，不需要通过辅助索引树找到主键，再通过主键去主键索引树里获取其他字段值。</p>\n<ul>\n<li>覆盖索引</li>\n</ul>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"sql\" data-theme=\"github-dark-dimmed\"><code data-language=\"sql\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">EXPLAIN</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">SELECT</span><span style=\"color:#ADBAC7\"> film_id</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">FROM</span><span style=\"color:#ADBAC7\"> film_actor</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">WHERE</span><span style=\"color:#ADBAC7\"> film_id </span><span style=\"color:#F47067\">=</span><span style=\"color:#6CB6FF\"> 1</span><span style=\"color:#ADBAC7\">;</span></span></code></pre></figure>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"json\" data-theme=\"github-dark-dimmed\"><code data-language=\"json\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">[</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"SIMPLE\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"film_actor\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"ref\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"idx_film_actor_id\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"idx_film_actor_id\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"4\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"const\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">2</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">100</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"Using index\"</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">]</span></span></code></pre></figure>\n<ul>\n<li>非覆盖索引</li>\n</ul>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"sql\" data-theme=\"github-dark-dimmed\"><code data-language=\"sql\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">EXPLAIN</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">SELECT</span><span style=\"color:#F47067\"> *</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">FROM</span><span style=\"color:#ADBAC7\"> film_actor</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">WHERE</span><span style=\"color:#ADBAC7\"> film_id </span><span style=\"color:#F47067\">=</span><span style=\"color:#6CB6FF\"> 1</span><span style=\"color:#ADBAC7\">;</span></span></code></pre></figure>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"json\" data-theme=\"github-dark-dimmed\"><code data-language=\"json\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">[</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"SIMPLE\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"film_actor\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"ref\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"idx_film_actor_id\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"idx_film_actor_id\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"4\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"const\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">2</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">100</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">]</span></span></code></pre></figure>\n<h3>2. Using where</h3>\n<p>使用 <code>where</code> 语句来处理结果，并且查询的列未被索引覆盖。</p>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"sql\" data-theme=\"github-dark-dimmed\"><code data-language=\"sql\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">EXPLAIN</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">SELECT</span><span style=\"color:#F47067\"> *</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">FROM</span><span style=\"color:#ADBAC7\"> actor</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">WHERE</span><span style=\"color:#F47067\"> name</span><span style=\"color:#F47067\"> =</span><span style=\"color:#96D0FF\"> 'a'</span><span style=\"color:#ADBAC7\">;</span></span></code></pre></figure>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"json\" data-theme=\"github-dark-dimmed\"><code data-language=\"json\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">[</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"SIMPLE\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"actor\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"ALL\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">3</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">33.33</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"Using where\"</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">]</span></span></code></pre></figure>\n<h3>3. Using index condition</h3>\n<p>查询的列不完全被索引覆盖，<code>where</code> 条件是一个前导列的范围</p>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"sql\" data-theme=\"github-dark-dimmed\"><code data-language=\"sql\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">EXPLAIN</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">SELECT</span><span style=\"color:#F47067\"> *</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">FROM</span><span style=\"color:#ADBAC7\"> film_actor</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">WHERE</span><span style=\"color:#ADBAC7\"> film_id </span><span style=\"color:#F47067\">></span><span style=\"color:#6CB6FF\"> 1</span><span style=\"color:#ADBAC7\">;</span></span></code></pre></figure>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"json\" data-theme=\"github-dark-dimmed\"><code data-language=\"json\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">[</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"SIMPLE\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"film_actor\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"range\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"idx_film_actor_id\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"idx_film_actor_id\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"4\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">100</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"Using index condition\"</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">]</span></span></code></pre></figure>\n<h3>4. Using temporary</h3>\n<p>mysql 需要创建一张临时表来处理查询。出现这种情况一般需要进行优化，首先想到用索引来优化</p>\n<ol>\n<li><code>actor.name</code> 没有索引，此时创建来临时表来 <code>distinct</code></li>\n</ol>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"sql\" data-theme=\"github-dark-dimmed\"><code data-language=\"sql\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">EXPLAIN</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">SELECT DISTINCT</span><span style=\"color:#F47067\"> name</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">FROM</span><span style=\"color:#ADBAC7\"> actor;</span></span></code></pre></figure>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"json\" data-theme=\"github-dark-dimmed\"><code data-language=\"json\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">[</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"SIMPLE\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"actor\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"ALL\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">3</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">100</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"Using temporary\"</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">]</span></span></code></pre></figure>\n<ol start=\"2\">\n<li><code>film.name</code> 建立来 <code>idx_name</code> 索引，此时查询时 <code>extra</code> 是 <code>using index</code>，没有用临时表</li>\n</ol>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"sql\" data-theme=\"github-dark-dimmed\"><code data-language=\"sql\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">EXPLAIN</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">SELECT DISTINCT</span><span style=\"color:#F47067\"> name</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">FROM</span><span style=\"color:#ADBAC7\"> film;</span></span></code></pre></figure>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"json\" data-theme=\"github-dark-dimmed\"><code data-language=\"json\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">[</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"SIMPLE\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"film\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"index\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"idx_name\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"idx_name\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"33\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">3</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">100</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"Using index\"</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">]</span></span></code></pre></figure>\n<h3>5. Using filesort</h3>\n<p>将用外部排序而不是索引排序，数据较小时从内存排序，否则需要在磁盘完成排序。这种情况下一般也是要考虑用索引来优化。</p>\n<ul>\n<li>使用外部排序\n<code>actor.name</code>未创建索引，会浏览<code>actor</code>整个表，保存排序关键字<code>name</code>和对应的<code>id</code>，然后排序<code>name</code>并检索行记录。</li>\n</ul>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"sql\" data-theme=\"github-dark-dimmed\"><code data-language=\"sql\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">EXPLAIN</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">SELECT</span><span style=\"color:#F47067\"> *</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">FROM</span><span style=\"color:#ADBAC7\"> actor</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">ORDER BY</span><span style=\"color:#F47067\"> name</span><span style=\"color:#ADBAC7\">;</span></span></code></pre></figure>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"json\" data-theme=\"github-dark-dimmed\"><code data-language=\"json\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">[</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"SIMPLE\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"actor\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"ALL\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">3</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">100</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"Using filesort\"</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">]</span></span></code></pre></figure>\n<ul>\n<li>利用索引优化</li>\n</ul>\n<p><code>film.name</code> 建立了 <code>idx_name</code> 索引，此时查询时 <code>extra</code> 是 <code>using index</code>。</p>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"sql\" data-theme=\"github-dark-dimmed\"><code data-language=\"sql\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">EXPLAIN</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">SELECT</span><span style=\"color:#F47067\"> *</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">FROM</span><span style=\"color:#ADBAC7\"> film</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">ORDER BY</span><span style=\"color:#F47067\"> name</span><span style=\"color:#ADBAC7\">;</span></span></code></pre></figure>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"json\" data-theme=\"github-dark-dimmed\"><code data-language=\"json\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">[</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"SIMPLE\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"film\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"index\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"idx_name\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"33\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">3</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">100</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"Using index\"</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">]</span></span></code></pre></figure>\n<h3>6. Select tables optimized away</h3>\n<p>使用某些聚合函数(比如 <code>max</code>、<code>min</code>)来访问存在索引的某个字段时</p>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"sql\" data-theme=\"github-dark-dimmed\"><code data-language=\"sql\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">EXPLAIN</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">SELECT</span><span style=\"color:#6CB6FF\"> MIN</span><span style=\"color:#ADBAC7\">(id)</span></span>\n<span data-line=\"\"><span style=\"color:#F47067\">FROM</span><span style=\"color:#ADBAC7\"> film;</span></span></code></pre></figure>\n<figure data-rehype-pretty-code-figure=\"\"><pre style=\"background-color:#22272e;color:#adbac7\" tabindex=\"0\" data-language=\"json\" data-theme=\"github-dark-dimmed\"><code data-language=\"json\" data-theme=\"github-dark-dimmed\" style=\"display: grid;\"><span data-line=\"\"><span style=\"color:#ADBAC7\">[</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  {</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"id\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">1</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"select_type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"SIMPLE\"</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"table\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"partitions\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"type\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"possible_keys\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"key_len\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"ref\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"rows\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"filtered\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#6CB6FF\">null</span><span style=\"color:#ADBAC7\">,</span></span>\n<span data-line=\"\"><span style=\"color:#8DDB8C\">    \"Extra\"</span><span style=\"color:#ADBAC7\">: </span><span style=\"color:#96D0FF\">\"Select tables optimized away\"</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">  }</span></span>\n<span data-line=\"\"><span style=\"color:#ADBAC7\">]</span></span></code></pre></figure>